<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>PhoneGap Plugins</title>

  <meta name="viewport" content="width=device-width"/>

  <link rel="stylesheet" href="./css/reset.css" type="text/css"/>
  <link rel="stylesheet" href="./css/showoff.css" type="text/css"/>

  <script type="text/javascript" src="./js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="./js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="./js/jquery-print.js"></script>
  <script type="text/javascript" src="./js/jquery.batchImageLoad.js"></script>

  <script type="text/javascript" src="./js/jquery.doubletap-0.1.js"></script>

  <script type="text/javascript" src="./js/fg.menu.js"></script>
  <script type="text/javascript" src="./js/showoff.js"></script>
  <script type="text/javascript" src="./js/jTypeWriter.js"> </script>
  <script type="text/javascript" src="./js/sh_main.min.js"></script>
  <script type="text/javascript" src="./js/core.js"></script>
  <script type="text/javascript" src="./js/showoffcore.js"></script>
  <script type="text/javascript" src="./js/coffee-script.js"></script>

  <link type="text/css" href="./css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/sh_style.css" rel="stylesheet" >

  
    <link rel="stylesheet" href="file/extension.css" type="text/css"/>
  

  

  <script type="text/javascript">
  $(function(){
      setupPreso(false, './');
  });
  </script>

</head>

<body>

<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>

<div id="help">
  <table>
    <tr><td class="key">z, ?</td><td>toggle help (this)</td></tr>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">shift-space, &larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>toggle debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c, t</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">n</td><td>toggle notes</td></tr>
    <tr><td class="key">p</td><td>run preshow</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso">loading presentation...</div>
<div id="footer">
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
  <span id="notesInfo"></span>
</div>

<div id="slides" class="offscreen" style="display:none;">
<div class="slide" data-transition="none"><div class="content title-slide" ref="intro/slides/1">
<h1>PhoneGap Plugins</h1>

<p>PhoneGap Day Portland 2012</p>

<p>Don Coleman</p></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="intro/slides/2">
<p><img src="./file/intro/plugin.png" width="410" height="410" alt="Plugin"/></p>

<ul>
<li>JavaScript</li>
<li>Native</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="javascript/javascript/1">
<p><img src="./file/javascript/js.png" width="512" height="512" alt="js"/></p></div>
</div><div class="slide" data-transition="none"><div class="content" ref="javascript/javascript/2">
<p class="notes">cordova.exec is the method that lets javascript call into native code
each platform has their own implementation but the interface is the same
 * win - the success callback
 * fail - the error callback
 * service - the name of the service to use
 * action - the action to run in cordova
 * args - Zero or more arguments to pass to the method</p>

<pre class="sh_javascript"><code>    cordova.exec(successCallback,
                 failureCallback,
                 service,
                 action, 
                 args)</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="javascript/javascript/3">
<pre class="sh_javascript"><code>    cordova.exec(win,
                 fail,
                 service,
                 action, 
                 args)</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="javascript/javascript/4">
<pre class="sh_javascript"><code>    var win = function (result) {
        alert (result);     
    }

    var fail = function (error) {
        alert ("Error " + error)
    }</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="javascript/javascript/5">
<p class="notes">when we run cordova.exec it calls into our native plugin
if the plugin is successful, it will call win with the String "Hello, World"</p>

<pre class="sh_javascript"><code>    var service = "Hello",
        action = "greet",
        args = ["World"];

    cordova.exec(win, fail, 
        service, action, args);</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="javascript/javascript/6">
<p class="notes">it is fine to call cordova.exec directly
typically a plugin provides wrapper javascript to make a nicer API for the plugins
usually you'll see the success failure callbacks as the last parameters, since they are optional</p>

<pre class="sh_javascript"><code>var greet = function (name, win, fail) {
    cordova.exec(win, fail, 
        "Hello", "greet", [name]);      
}

greet("World", win, fail);</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="javascript/javascript/7">
<p class="notes">TODO make sure this works!</p>

<pre class="sh_javascript"><code>cordova.define("cordova/plugin/hello",
  function (require, exports, module) {

    var exec = require('cordova/exec');

    function greet(name, win, fail) {
      exec(win, fail, "Hello",
          "greet", [name]);
    }

    module.exports = {
      greet: greet
    }
  }
);</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="config/config/1">


<!-- [Wrench Image] -->


<h1>&lt;? xml ... &gt;</h1></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="config/config/2">
<h2>Android - res/xml/config.xml</h2>

<h2>Blackbery - www/plugins.xml</h2>

<pre class="sh_xml"><code>    &lt;plugin name="Hello" 
       value="com.example.plugin.Hello"/&gt;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="config/config/3">
<h2>iOS - Cordova.plist</h2>

<pre class="sh_xml"><code>    &lt;dict&gt;
        &lt;key&gt;Hello&lt;/key&gt;
        &lt;string&gt;HWPHello&lt;/string&gt;
    &lt;/dict&gt;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="android/android/1">
<p><img src="./file/android/android_robot.png" width="400" height="400" alt="Android Robot"/></p>

<ul>
<li>org.apache.cordova.api.Plugin</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="android/android/2">
<pre class="sh_java"><code>import org.apache.cordova.api.Plugin

public class Hello extends Plugin {

    public PluginResult execute(
                        String action, 
                        JSONArray args, 
                        String callbackId)</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="android/android/3">
<p class="notes">PluginResults sends data back to Javascript
PluginResult.Status tells Cordova how to process the result.
Message can be String, JSONArray or JSONObject
PluginResult is how data goes <em>from</em> the native code back <em>to</em> JavaScript</p>

<pre class="sh_java"><code>new PluginResult(Status.OK, message);</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="android/android/4">
<p class="notes">TODO REMOVE THIS SLIDE</p>

<pre class="sh_java"><code>new PluginResult(Status.IO_EXCEPTION);

new PluginResult(Status.NO_RESULT);</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="android/android/5">
<p class="notes">Won't compile</p>

<pre class="sh_java"><code>public PluginResult execute(
                String action, 
                JSONArray args, 
                String callbackId) {

    String name = args.getString(0);
    String message = "Hello, " + name;

    return new PluginResult(
                Status.OK, message);
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="android/android/6">
<p class="notes">args is a JSONArray and throws a JSONException
add a try catch
Note if Cordova gets Status.JSON_EXCEPTION the fail callback is called instead of success</p>

<pre class="sh_java"><code>try {
    String name = args.getString(0);
    String message = "Hello, " + name;

    return new PluginResult(
                Status.OK, message);

} catch (JSONException e) {

    return new PluginResult(
                Status.JSON_EXCEPTION);
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="android/android/7">
<p class="notes">the previous code will work (but omits error and bounds checking)
We are also ignoring the action that was called
For a java plugin, <em>all</em> actions go through the one execute method
Plugins typically have multiple actions, so we need to check which action was called
If we get an unexpected action, we return an INVALID_ACTION status which called the fail callback</p>

<pre class="sh_java"><code>public PluginResult execute(
                String action, 
                JSONArray args, 
                String callbackId) {

    if (action.equals("greet")) {
        // ...
    } else if (action.equals("leave")) {
        // ...      
    } else {
        return new PluginResult(
            Status.INVALID_ACTION);
    }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="android/android/8">
<h1>config.xml</h1>

<pre class="sh_xml"><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;cordova&gt;
    &lt;!-- ... --&gt;
    &lt;plugins&gt;
      &lt;plugin name="App" 
        value="org.apache.cordova.App"/&gt;
      &lt;!-- ... --&gt;
      &lt;plugin name="Hello" 
        value="com.example.plugin.Hello"/&gt;
    &lt;/plugins&gt;
&lt;/cordova&gt;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="android/android/9">
<p class="notes">implementation is complete
compile and run the code</p>

<p><img src="./file/android/hello_world.png" width="800" height="450" alt="hello_world"/></p></div>
</div><div class="slide" data-transition="none"><div class="content" ref="android/android/10">
<p class="notes">Thank Fil for example</p>

<pre class="sh_java"><code>public PluginResult execute(String action, 
  JSONArray args, String callbackId) {

    this.callbackId = callbackId;
    PluginResult result = 
      new PluginResult(Status.NO_RESULT);
    result.setKeepCallback(true);
    return result;
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="android/android/11">
<pre class="sh_java"><code>private void someNativeInvocation() {
    JSONObject data = // ...
    PluginResult result = 
        new PluginResult(Status.OK, data);

    this.success(result, this.callbackId);
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="android/android/12">
<p><img src="./file/android/blackberry_logo.jpg" width="500" height="500" alt="BlackBerry"/></p></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="ios/ios/1">
<p class="notes">the concepts for iOS are the same but the implementation is a bit different
implement CDVPlugin
create instance methods for each action
ObjectiveC
XCode
.notes Plugin Directory will exist if you've created your project with the cordova command line scripts</p>

<p><img src="./file/ios/ios_title.png" width="246" height="158" alt="iOS"/></p>

<ul>
<li>CDVPlugin</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="ios/ios/2">
<pre class="sh_c"><code>#import &lt;Cordova/CDVPlugin.h&gt;

@interface HWPHello : CDVPlugin

- (void) greet:(NSMutableArray*)arguments 
      withDict:(NSMutableDictionary*)opt;

@end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="ios/ios/3">
<pre class="sh_c"><code>#import &lt;Cordova/CDVPlugin.h&gt;

@interface HWPHello : CDVPlugin

- (void) greet:(NSMutableArray*)arguments 
      withDict:(NSMutableDictionary*)opt;

- (void) leave:(NSMutableArray*)arguments 
      withDict:(NSMutableDictionary*)opt;

@end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="ios/ios/4">
<p class="notes">id is the callbackId
note that in iOS we need to use the callbackId and decide to call success or failure</p>

<pre class="sh_c"><code>- (void)greet:(NSMutableArray*)args ...
{
  NSString* id = [args objectAtIndex:0];

  NSString* name = [args objectAtIndex:1];
  NSString* msg = [NSString
    stringWithFormat: @"Hello, %@", name];

  CDVPluginResult* result = [
    CDVPluginResult 
    resultWithStatus:CDVCommandStatus_OK
     messageAsString:msg];

  [super success:result callbackId:id];
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="ios/ios/5">
<p><img src="./file/ios/cordova.plist.png" width="798" height="259" alt="cordova.plist"/></p></div>
</div><div class="slide" data-transition="none"><div class="content" ref="ios/ios/6">
<pre class="sh_c"><code>CDVPluginResult* result = // ...
NSString* javaScript = 
    [result toSuccessCallbackString:id];

[self writeJavascript:javaScript]</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="windowsphone/wp7/1">
<p><img src="./file/windowsphone/windows_phone_logo.jpg" width="400" height="400" alt="Windows Phone"/></p>

<ul>
<li>BaseCommand</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="windowsphone/wp7/2">
<pre class="sh_java"><code>namespace Cordova.Extension.Commands
{
  public class Hello : BaseCommand
  {
    public void greet(string args)
    {
      string name = JsonHelper
        .Deserialize&lt;string&gt;(args);
      string message = "Hello, " + name;

      PluginResult result = 
          new PluginResult(
            PluginResult.Status.OK,
            message);

      DispatchCommandResult(result);
} } }</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="wrapup/wrapup/1">
<p class="notes">add to script
* Maintaining plugins for multiple platforms
* Building, Packaging and Distributing plugins.
* Installing  (apt-get | npm  for plugins?)
* Making plugins work with PhoneGap build
* https://github.com/alunny/cordova-plugin-spec</p>

<h1>Future</h1></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="wrapup/wrapup/2">
<h1>Plugin Spec</h1>

<ul>
<li><a href="https://github.com/alunny/cordova-plugin-spec">https://github.com/alunny/cordova-plugin-spec</a></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="wrapup/wrapup/3">
<pre class="sh_xml"><code>&lt;plugin xmlns= ...
        id="com.example.hello"
        version="0.9.0"&gt;
    &lt;name&gt;Hello&lt;/name&gt;
    &lt;asset src="www/hello.js" 
        target="hello.js" /&gt;
    &lt;platform name="ios"&gt;
        &lt;header-file src="HWPHello.h" /&gt;    
        &lt;source-file src="HWPHello.m" /&gt;    
        &lt;plugins-plist key="Hello" 
            string="HWPHello" /&gt;    
    &lt;/platform&gt; 
    &lt;platform name="android"&gt;
        ...
    &lt;/platform&gt;
&lt;/plugin&gt;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="wrapup/wrapup/4">
<h1>pluginstall</h1>

<ul>
<li>pluginstall PLATFORM PROJECT PLUGIN</li>
<li>pluginstall ios . ~/plugins/Hello</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="wrapup/wrapup/5">
<p class="notes">* start writing code
* read the Cordova source
* read the Plugin source (some will be dated)</p>

<h1>Go Build a Plugin</h1>

<!-- !SLIDE
The team is working on documentation
.notes https://issues.apache.org/jira/browse/CB-862

# links -->


</div>
</div><div class="slide" data-transition="none"><div class="content" ref="wrapup/wrapup/6">
<p class="notes">TODO add a link to these slides on github</p>

<h2>PhoneGap Plugins</h2>

<p>Don Coleman</p>

<p>don@chariotsolutions.com</p>

<p>http://github.com/don</p>

<p>@doncoleman</p></div>
</div></div>

</body>
</html>
